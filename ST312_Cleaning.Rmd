---
title: "ST312"
author: "Aodhan hatch and Krish Nair"
date: "2025-01-25"
output: html_document
---
```{r}
cleaned_kickstarter_data <- read_csv("cleaned_kickstarter_data.csv")
```

```{r}
# List all objects with names starting with "Kickstarter"
#Combined data atm is not combining all the datasets together

files  <- list.files(path = "/Users/krishnair/Programming Materials/ST312/Data")

library(dplyr)

# Retrieve all datasets as a list
setwd("/Users/krishnair/Programming Materials/ST312/Data")
data_list <- lapply(files, read.csv) 

setwd("/Users/krishnair/Programming Materials/ST312")
# Combine all datasets into one large data frame
combined_data <- bind_rows(data_list, .id = "source")
# View the first few rows
head(combined_data)

```
```{r}
library(dplyr)

# Remove duplicate rows based on ID column
combined_data <- combined_data %>% distinct(id, .keep_all = TRUE)

duplicates <- combined_data %>%
  group_by(id) %>%
  filter(n() > 1)

# View the duplicate rows
print(duplicates) #0 duplicate rows found now

```



```{r}
# Delete some objects
library(dplyr)

# List of columns to remove
columns_to_remove <- c(
  "source", "country", "currency_symbol", "disable_communication", "current_currency", 
  "fx_rate", "is_disliked", "is_liked", "is_starrable", 
  "photo", "prelaunch_activated", "slug",
  "usd_exchange_rate", "usd_pledged", "usd_type",
  "urls", "spotlight", "source_url", "profile", "pledged", "percent_funded", "is_in_post_campaign_pledging_phase",
  "creator",  "currency_trailing_code", "location", "is_launched"
)

# Remove the specified columns
cleaned_kickstarter_data <- combined_data %>%
  select(-all_of(columns_to_remove))
```


```{r}

# Assuming your dataset is named cleaned_kickstarter_data

# Create a new column 'goal_usd' by multiplying 'goal' with 'static_usd_rate'
cleaned_kickstarter_data$goal_usd <- cleaned_kickstarter_data$goal * cleaned_kickstarter_data$static_usd_rate

# Remove the old 'goal' and 'static_usd_rate' columns
cleaned_kickstarter_data <- subset(cleaned_kickstarter_data, select = -c(goal, static_usd_rate))

```


```{r}
#Now we want to edit the columns themselves




library(jsonlite)
library(dplyr)
library(lubridate)
library(purrr)

cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  mutate(video = ifelse(is.na(video) | video == "null", FALSE, TRUE)) #recodes video column as being TRUE if there is a video and FALSE if not


cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  filter(!state %in% c("live", "submitted", "started", "suspended")) %>%  # Remove unwanted rows
  mutate(state = ifelse(state == "canceled", "failed", state))  # Rename "canceled" to "failed"

# Convert Unix timestamps to hours difference
cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  mutate(campaign_duration = (state_changed_at - launched_at) / 3600) #campaign duration is in hours

cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  mutate(year_launched = year(as_datetime(launched_at)))

cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  mutate(desired_duration = (deadline - launched_at) / 3600)

cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  mutate(
    desired_duration = round(desired_duration),
    campaign_duration = round(campaign_duration)
  )

# Convert 'launched_at' to POSIXct and extract the weekday
cleaned_kickstarter_data$day_launched <- weekdays(
  as.POSIXct(cleaned_kickstarter_data$launched_at, origin = "1970-01-01", tz = "UTC")
)


cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  filter(goal_usd >= 50) #removed all rows with goal less than 50 dollars (Dollars is the assumed currency but not sure actually)


cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  mutate(month_launched = format(as.POSIXct(created_at, origin = "1970-01-01", tz = "UTC"), "%B"))

safe_extract <- function(json_str, field) {
  parsed <- tryCatch(fromJSON(json_str), error = function(e) list())  # Parse JSON safely
  if (!is.null(parsed[[field]])) {
    return(parsed[[field]])  # Return field if it exists
  } else {
    return(NA)  # Return NA if field is missing
  }
}

# Apply extraction with safety checks
cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  mutate(
    subcategory = map_chr(category, ~ safe_extract(., "name")),
    category = map_chr(category, ~ safe_extract(., "parent_name"))
  )

cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  mutate(blurb_characters = nchar(blurb))

cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  select(-blurb)

```


```{r}
#Let's now code the variables with the correct types
cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  mutate(state = ifelse(state == "successful", TRUE, FALSE))

cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  mutate(staff_pick = ifelse(staff_pick == "true", TRUE, FALSE))



cleaned_kickstarter_data$category <- as.factor(cleaned_kickstarter_data$category)
cleaned_kickstarter_data$subcategory <- as.factor(cleaned_kickstarter_data$subcategory)
cleaned_kickstarter_data$currency <- as.factor(cleaned_kickstarter_data$currency)
cleaned_kickstarter_data$country_displayable_name <- as.factor(cleaned_kickstarter_data$country_displayable_name)
cleaned_kickstarter_data$month_launched <- as.factor(cleaned_kickstarter_data$month_launched)

# Convert converted_pledged_amount to numeric
cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  mutate(converted_pledged_amount = as.numeric(converted_pledged_amount))
```

```{r}
# Removing the now unnecessary columns
cleaned_kickstarter_data <- cleaned_kickstarter_data %>%
  select(-created_at, -deadline, -id, -launched_at, -state_changed_at)
```

```{r}
# View the cleaned dataset
cleaned_kickstarter_data$goal_usd <- round(cleaned_kickstarter_data$goal_usd, 2)
View(cleaned_kickstarter_data)
write.csv(cleaned_kickstarter_data, "cleaned_kickstarter_data.csv", row.names = FALSE)
# Let us check for missing values
colSums(is.na(cleaned_kickstarter_data))
```

```{r}

# Fit the logistic regression model

#WE CAN ALSO TRY AND PREDICT CONVERTED_PLEDGED_AMOUNT INSTEAD


logistic_model <- glm(state ~ backers_count + category + currency + goal + 
                      staff_pick + video + campaign_duration + year_launched + 
                      desired_duration + subcategory + blurb_characters, 
                      data = cleaned_kickstarter_data, family = binomial)

# Display model summary
summary(logistic_model)

```
The next steps include outlier analysis (which will probably be quite relevant here), checking for multicollinearity, maybe only fitting the model with predictors like category instead of subcategory and including interactions. 

After that we will look at trying other models out.






```{r}
# Check for multicollinearity
set.seed(123)
library(car)
# We will refit a lm model so that we can caluclate multicolinearity a bit easier
linear_model <- lm(log_goal ~ staff_pick + spotlight, data = cleaned_kickstarter_data)

# Calculate VIF
vif_values <- vif(linear_model)
print("Variance Inflation Factors (VIF):")
print(vif_values)

```
From these results, we can see that multicollinearity in these predictors does not seem to be too much of an issue with the low VIF figure we have.
(Need to tryout other variables but these were the easiest predictors to start with)